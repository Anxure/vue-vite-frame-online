function e(e,n){void 0===n&&(n={});for(var r=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var i=1,a="";if("?"===e[c=n+1])throw new TypeError('Pattern cannot start with "?" at '.concat(c));for(;c<e.length;)if("\\"!==e[c]){if(")"===e[c]){if(0===--i){c++;break}}else if("("===e[c]&&(i++,"?"!==e[c+1]))throw new TypeError("Capturing groups are not allowed at ".concat(c));a+=e[c++]}else a+=e[c++]+e[c++];if(i)throw new TypeError("Unbalanced pattern at ".concat(n));if(!a)throw new TypeError("Missing pattern at ".concat(n));t.push({type:"PATTERN",index:n,value:a}),n=c}else{for(var o="",c=n+1;c<e.length;){var f=e.charCodeAt(c);if(!(f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||95===f))break;o+=e[c++]}if(!o)throw new TypeError("Missing parameter name at ".concat(n));t.push({type:"NAME",index:n,value:o}),n=c}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),i=n.prefixes,a=void 0===i?"./":i,o=n.delimiter,c=void 0===o?"/#?":o,f=[],u=0,p=0,s="",d=function(e){if(p<r.length&&r[p].type===e)return r[p++].value},v=function(e){var t=d(e);if(void 0!==t)return t;var n=r[p],i=n.type,a=n.index;throw new TypeError("Unexpected ".concat(i," at ").concat(a,", expected ").concat(e))},l=function(){for(var e,t="";e=d("CHAR")||d("ESCAPED_CHAR");)t+=e;return t},h=function(e){var n=f[f.length-1],r=e||(n&&"string"==typeof n?n:"");if(n&&!r)throw new TypeError('Must have text between two parameters, missing text after "'.concat(n.name,'"'));return!r||function(e){for(var t=0,n=c;t<n.length;t++){var r=n[t];if(e.indexOf(r)>-1)return!0}return!1}(r)?"[^".concat(t(c),"]+?"):"(?:(?!".concat(t(r),")[^").concat(t(c),"])+?")};p<r.length;){var x=d("CHAR"),E=d("NAME"),g=d("PATTERN");if(E||g){var m=x||"";-1===a.indexOf(m)&&(s+=m,m=""),s&&(f.push(s),s=""),f.push({name:E||u++,prefix:m,suffix:"",pattern:g||h(m),modifier:d("MODIFIER")||""})}else{var w=x||d("ESCAPED_CHAR");if(w)s+=w;else if(s&&(f.push(s),s=""),d("OPEN")){m=l();var y=d("NAME")||"",A=d("PATTERN")||"",R=l();v("CLOSE"),f.push({name:y||(A?u++:""),pattern:y&&!A?h(m):A,prefix:m,suffix:R,modifier:d("MODIFIER")||""})}else v("END")}}return f}function t(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function n(e){return e&&e.sensitive?"":"i"}function r(e,r,i){void 0===i&&(i={});for(var a=i.strict,o=void 0!==a&&a,c=i.start,f=void 0===c||c,u=i.end,p=void 0===u||u,s=i.encode,d=void 0===s?function(e){return e}:s,v=i.delimiter,l=void 0===v?"/#?":v,h=i.endsWith,x="[".concat(t(void 0===h?"":h),"]|$"),E="[".concat(t(l),"]"),g=f?"^":"",m=0,w=e;m<w.length;m++){var y=w[m];if("string"==typeof y)g+=t(d(y));else{var A=t(d(y.prefix)),R=t(d(y.suffix));if(y.pattern)if(r&&r.push(y),A||R)if("+"===y.modifier||"*"===y.modifier){var C="*"===y.modifier?"?":"";g+="(?:".concat(A,"((?:").concat(y.pattern,")(?:").concat(R).concat(A,"(?:").concat(y.pattern,"))*)").concat(R,")").concat(C)}else g+="(?:".concat(A,"(").concat(y.pattern,")").concat(R,")").concat(y.modifier);else{if("+"===y.modifier||"*"===y.modifier)throw new TypeError('Can not repeat "'.concat(y.name,'" without a prefix and suffix'));g+="(".concat(y.pattern,")").concat(y.modifier)}else g+="(?:".concat(A).concat(R,")").concat(y.modifier)}}if(p)o||(g+="".concat(E,"?")),g+=i.endsWith?"(?=".concat(x,")"):"$";else{var T=e[e.length-1],N="string"==typeof T?E.indexOf(T[T.length-1])>-1:void 0===T;o||(g+="(?:".concat(E,"(?=").concat(x,"))?")),N||(g+="(?=".concat(E,"|").concat(x,")"))}return new RegExp(g,n(i))}function i(t,a,o){return t instanceof RegExp?function(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=n.exec(e.source);i;)t.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=n.exec(e.source);return e}(t,a):Array.isArray(t)?function(e,t,r){var a=e.map(function(e){return i(e,t,r).source});return new RegExp("(?:".concat(a.join("|"),")"),n(r))}(t,a,o):function(t,n,i){return r(e(t,i),n,i)}(t,a,o)}export{e as parse,i as pathToRegexp,r as tokensToRegexp};
